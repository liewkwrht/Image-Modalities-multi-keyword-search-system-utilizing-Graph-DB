<!-- search.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neo4j Search</title>

    <!-- Include the Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Include jQuery (required for Select2) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Include the Select2 JavaScript -->
    <script 
    src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        /* Adjust the width of the dropdown container */
    /* Adjust the width of the dropdown container */
    #symptoms {
        width: 300px; /* Adjust the width as needed */
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function() {
        // Initialize Select2 for symptoms and targetClasses dropdowns
        $('#symptoms, #targetClasses').select2({
            multiple: true,
            tags: true,
            tokenSeparators: [','],
            placeholder: 'Select...'
        });
    
        // Preselect the targetClasses dropdown with the provided values
        const targetClassesValues = ["X_ray", "CT", "MRI", "DSI", "US"];
        $('#targetClasses').val(targetClassesValues).trigger('change');
    
        // Function to handle the form submission and make an API call
        $('#searchForm').on('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            console.log($('#symptoms').val()); // Should log an array of selected symptom values
            console.log($('#targetClasses').val()); // Should log an array of selected target class values
            
            // Get values from form fields
            const name = $('#name').val();
            const id = $('#id').val();
            const disease = $('#disease').val();
            const bodyPart = $('#bodypart').val();
            const symptoms = $('#symptoms').val() || [];// Using jQuery for Select2
            const targetClasses = $('#targetClasses').val() || []; // Using jQuery for Select2
    
            // Construct the search data object
            let searchData = {
                name: name,
                patient_id: id ? parseInt(id) : undefined,
                bodypart: bodyPart !== 'null' ? bodyPart : undefined,
                disease: disease !== 'null' ? disease : undefined,
                symptoms: symptoms,
                targetClasses: targetClasses
            };
    
            // Filter out empty strings and null values
            searchData = Object.fromEntries(Object.entries(searchData).filter(([_, v]) => v != null && v !== ''));
    
            // Redirect to result page with query parameters
            const searchParams = new URLSearchParams(searchData).toString();
            window.location.href = `result.html?${searchParams}`;
        });
    });
    </script>
    
    
</head>
<body>
    <h1>Neo4j Search</h1>
    <form id="searchForm" action="result.html" method="GET">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" placeholder="Enter Name">
        <br><br>

        <label for="id">ID:</label>
        <input type="text" id="id" name="patient_id" placeholder="Enter ID">
        <br><br>

        <label for="bodypart">Body Part:</label>
        <select id="bodypart" name = "bodypart">
        <!-- Add more body part options as needed -->
            <option value="" selected disabled>Select Body Part</option>
            <option value="null">Don't select</option> 
            <option value="Breast">Breast</option>
            <option value="Wrist">Wrist</option>
            <option value="Herniated_Disc">Herniated Disc</option>
            <option value="Stomach">Stomach</option>
            <option value="Ovaries">Ovaries</option>
            <option value="Shoulder">Shoulder</option>
            <option value="Esophagus">Esophagus</option>
            <option value="Brain">Brain</option>
            <option value="Lung">Lung</option>
            <option value="Knee">Knee</option>
            <option value="Leg">Leg</option>
            <option value="Arm">Arm</option>
            <option value="Head">Head</option>
            <option value="BloodSystem">Blood System</option>
            <option value="Heart">Heart</option>
            <option value="Thyroid">Thyroid</option>
            <option value="Testicles">Testicles</option>
            <option value="Bladder">Bladder</option>
            <option value="Kidney">Kidney</option>
            <option value="Pancreas">Pancreas</option>
            <option value="Liver">Liver</option>
            <option value="Rib">Rib</option>
            <option value="Ankle">Ankle</option>
            <option value="Elbow">Rib</option>
            <option value="Spine">Spine</option>
        </select>
        <br><br>

        <label for="symptoms">Symptoms:</label>
        <select id="symptoms" name="symptoms" multiple="multiple">
            <option value="" selected disabled>Select symptoms</option>
            <option value="null">Don't select</option> 
            <option value="Pain">Pain</option>
            <option value="Bone_Protruding">Bone Protruding</option>
            <option value="Ache_Pain">Ache Pain</option>
            <option value="Neurological">Neurological</option>
            <option value="Fatigue">Fatigue</option>
            <option value="Headache">Headache</option>
            <option value="Breathing_Difficulties">Breathing Difficulties</option>
            <option value="Skin_Changes">Skin Changes</option>
            <option value="Nausea">Nausea</option>
            <option value="Changes_In_Urination">Changes in Urination</option>
            <option value="Changes_In_Vision">Changes in Vision</option>
            <option value="Fever">Fever</option>
            <option value="Swelling">Swelling</option>
            <option value="Limited_Mobility">Limited Mobility</option>
            <option value="Cough">Cough</option>
            <option value="Vomiting">Vomiting</option>
            <option value="Blood_In_Urine">Blood in Your Urine</option>
            <option value="Problems_With_Movement">Problems with Movement</option>
            <option value="Speech_Difficulty">Speech Difficulty</option>
            <option value="Dizziness">Dizziness</option>
            <option value="Bone_Spurs">Bone Spurs</option>
            <option value="Loss_of_Flexibility">Loss of Flexibility</option>
            <option value="Crepitus">Crepitus</option>
            <option value="Muscle_Weakness">Muscle Weakness</option>
            <option value="Weight_Loss">Weight Loss</option>
            <option value="Night_Sweats">Night Sweats</option>
        </select>

        <label for="disease">Disease:</label>
        <select id="disease" name="disease">
            <option value="" selected disabled>Select a disease</option>
            <option value="">Don't select</option> 
            <option value="Cancer">Cancer</option>
            <option value="Bone_Fractures">Bone Fractures</option>
            <option value="Pneumonia">Pneumonia</option>
            <option value="Kidney_Stones">Kidney Stones</option>
            <option value="Head_Trauma">Head Trauma</option>
            <option value="Osteoarthritis">Osteoarthritis</option>
            <option value="Spinal_Disc_Herniation">Spinal Disc Herniation</option>
            <option value="Osteoporosis">Osteoporosis</option>
            <option value="Tuberculosis">Tuberculosis</option>
            <option value="Traumatic_Injuries">Traumatic Injuries</option>
            <option value="Appendicitis">Appendicitis</option>
            <option value="Blood_Clots">Blood Clots</option>
            <option value="Abdominal_Tumors">Abdominal Tumors</option>
            <option value="Spinal_Cord_Injuries">Spinal Cord Injuries</option>
            <option value="Stroke">Stroke</option>
            <option value="Joint_Injuries">Joint Injuries</option>
        </select>
        <br><br>

        <label for="targetClasses">Target Classes:</label>
        <select id="targetClasses" name="targetClasses" multiple="multiple">
            <option value="X_ray">X-ray</option>
            <option value="CT">CT</option>
            <option value="MRI">MRI</option>
            <option value="DSI">DSI</option>
            <option value="US">US</option>
            <!-- Add more target class options as needed -->
        </select>
            <!-- Add more symptom options as needed -->
            <button type="submit">Search Neo4j</button>
        <script>
            // Initialize Select2 on the symptoms dropdown
            $(document).ready(function() {
                $('#symptoms').select2({
                    multiple: true,
                    tags: true,
                    tokenSeparators: [','],
                    placeholder: 'Select symptoms'
                });
            });
            const targetClassesValues = ["X_ray", "CT", "MRI", "DSI", "US"];
            $('#targetClasses').val(targetClassesValues).trigger('change');


    // Function to handle the form submission and make an API call
$('#searchForm').on('submit', function(event) {
        // Prevent the default form submission if you handle the form data with JavaScript
    event.preventDefault();
    console.log($('#symptoms').val()); // Should log an array of selected symptom values
    console.log($('#targetClasses').val());
    // Get values from form fields
    const name = document.getElementById('name').value;
    const id = document.getElementById('id').value;
    const disease = document.getElementById('disease').value;
    const bodyPart = document.getElementById('body_part').value;
    const symptoms = $('#symptoms').val() || []; // Using jQuery for Select2
    const targetClasses = $('#targetClasses').val() || []; // Using jQuery for Select2

    // Construct the search data object
    let searchData = {
        name: name,
        patient_id: id ? parseInt(id) : undefined,
        bodypart: bodyPart !== "" ? bodyPart : undefined,
        disease: disease !== "" ? disease : undefined,
        symptom: symptoms,
        targetClasses: targetClasses
    };

    // Filter out empty strings and null values
    searchData = Object.fromEntries(Object.entries(searchData).filter(([_, v]) => v != null && v !== ''));

    // Redirect to result page with query parameters
    const searchParams = new URLSearchParams(searchData).toString();
    window.location.href = `result.html?${searchParams}`;
})
,
document.getElementById('searchForm').addEventListener('submit', searchNeo4j)
